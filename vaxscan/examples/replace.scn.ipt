program
 MODULE
 id
  global_replace
 opt_ident
  ;
 module_statement_list
  module_statement_list
   module_statement_list
    module_statement_list
     module_statement_list
      module_statement_list
       module_statement_list
        module_statement_list
         module_statement_list
          module_statement_list
           module_statement
            declaration
             constant_declaration
              CONSTANT
              id
               search_string
              constant_type
               =
               exp
                exp1
                 exp2
                  exp3
                   exp4
                    exp5
                     exp6
                      exp7
                       exp8
                        exp9
                         string_literal
                          'old'
           ;
          module_statement
           declaration
            constant_declaration
             CONSTANT
             id
              replacement_string
             constant_type
              =
              exp
               exp1
                exp2
                 exp3
                  exp4
                   exp5
                    exp6
                     exp7
                      exp8
                       exp9
                        string_literal
                         'new'
          ;
         module_statement
          declaration
           constant_declaration
            CONSTANT
            id
             caseless_search
            constant_type
             =
             exp
              exp1
               exp2
                exp3
                 exp4
                  exp5
                   exp6
                    exp7
                     exp8
                      exp9
                       TRUE
         ;
        module_statement
         token_declaration
          TOKEN
          id
           search_token
          token_attrs
           token_attr_list
            token_attr
             CASELESS
          {
          token_exp
           token_exp1
            token_exp2
             token_exp3
              id
               search_string
          }
        ;
       module_statement
        declaration
         variable_declaration
          DECLARE
          name_list
           pic_id
            id
             replacement_count
          :
          type_dec
           common_type_dec
            INTEGER
       ;
      module_statement
       macro_declaration
        MACRO
        id
         replace_string
        macro_type
         TRIGGER
        opt_macro_attrs
        {
        opt_picture
         picture
          pic1
           pic2
            pic3
             pic4
              id
               str
              :
              macro_item
               id
                search_token
        }
        ;
        body
         statement_list
          statement_list
           statement_list
            statement
             executable
              keyword_statement
               if_statement
                IF
                exp
                 exp1
                  exp2
                   NOT
                   exp2
                    exp3
                     exp4
                      exp5
                       exp6
                        exp7
                         exp8
                          exp9
                           ref
                            id
                             caseless_search
                THEN
                executable_list
                 executable
                  keyword_statement
                   if_statement
                    IF
                    exp
                     exp1
                      exp2
                       exp3
                        exp3
                         exp4
                          exp5
                           exp6
                            exp7
                             exp8
                              exp9
                               ref
                                id
                                 str
                        <>
                        exp4
                         exp5
                          exp6
                           exp7
                            exp8
                             exp9
                              ref
                               id
                                search_string
                    THEN
                    executable_list
                     executable
                      keyword_statement
                       fail_statement
                        FAIL
                     ;
                    opt_else_statement
                    END
                    IF
                 ;
                opt_else_statement
                END
                IF
             ;
           statement
            executable
             variable_ref
              var_ref
               write_id
                id
                 replacement_count
             =
             exp
              exp1
               exp2
                exp3
                 exp4
                  exp5
                   exp5
                    exp6
                     exp7
                      exp8
                       exp9
                        ref
                         id
                          replacement_count
                   +
                   exp6
                    exp7
                     exp8
                      exp9
                       1
            ;
          statement
           executable
            keyword_statement
             answer_statement
              ANSWER
              exp_list
               exp
                exp1
                 exp2
                  exp3
                   exp4
                    exp5
                     exp6
                      exp7
                       exp8
                        exp9
                         ref
                          id
                           replacement_string
           ;
        END
        MACRO
      ;
     module_statement
      declaration
       procedure_form_decl
        proc_name
         EXTERNAL
         PROCEDURE
         id
          lib$find_file
        opt_formal_list
         (
         formal_list
          formal_list
           formal_list
            formal
             type_dec
              STRING
           ,
           formal
            type_dec
             STRING
          ,
          formal
           type_dec
            common_type_dec
             INTEGER
         )
        opt_result
         OF
         type_dec
          common_type_dec
           INTEGER
     ;
    module_statement
     declaration
      procedure_form_decl
       proc_name
        EXTERNAL
        PROCEDURE
        id
         lib$find_file_end
       opt_formal_list
        (
        formal_list
         formal
          type_dec
           common_type_dec
            INTEGER
        )
       opt_result
        OF
        type_dec
         common_type_dec
          INTEGER
    ;
   module_statement
    procedure_declaration
     proc_start
      PROCEDURE
      id
       replace_file
     opt_parameter_list
      (
      parameter_list
       parameter
        id
         in_file_name
        :
        type_dec
         STRING
      )
     ;
     body
      statement_list
       statement_list
        statement_list
         statement_list
          statement_list
           statement_list
            statement_list
             statement
              declaration
               variable_declaration
                DECLARE
                name_list
                 name_list
                  pic_id
                   id
                    out_file_name
                 ,
                 pic_id
                  id
                   plural_string
                :
                type_dec
                 STRING
              ;
            statement
             executable
              variable_ref
               var_ref
                write_id
                 id
                  out_file_name
              =
              exp
               exp1
                exp2
                 exp3
                  exp4
                   exp5
                    exp6
                     exp7
                      exp8
                       exp9
                        ref
                         id
                          in_file_name
                       [
                       part_ref
                        exp
                         exp1
                          exp2
                           exp3
                            exp4
                             exp5
                              exp6
                               exp7
                                exp8
                                 exp9
                                  1
                        rest_of_part_ref
                         ..
                         exp
                          exp1
                           exp2
                            exp3
                             exp4
                              exp5
                               exp5
                                exp6
                                 exp7
                                  exp8
                                   exp9
                                    ref
                                     ref
                                      id
                                       index
                                     argument_list
                                      (
                                      arg_list
                                       arg_list
                                        arg
                                         exp
                                          exp1
                                           exp2
                                            exp3
                                             exp4
                                              exp5
                                               exp6
                                                exp7
                                                 exp8
                                                  exp9
                                                   ref
                                                    id
                                                     in_file_name
                                       ,
                                       arg
                                        exp
                                         exp1
                                          exp2
                                           exp3
                                            exp4
                                             exp5
                                              exp6
                                               exp7
                                                exp8
                                                 exp9
                                                  string_literal
                                                   ';'
                                      )
                               -
                               exp6
                                exp7
                                 exp8
                                  exp9
                                   1
                         ]
             ;
           statement
            executable
             keyword_statement
              write_statement
               WRITE
               exp_list
                exp_list
                 exp
                  exp1
                   exp2
                    exp3
                     exp4
                      exp5
                       exp6
                        exp7
                         exp8
                          exp9
                           string_literal
                            'processing: '
                ,
                exp
                 exp1
                  exp2
                   exp3
                    exp4
                     exp5
                      exp6
                       exp7
                        exp8
                         exp9
                          ref
                           id
                            in_file_name
            ;
          statement
           executable
            variable_ref
             var_ref
              write_id
               id
                replacement_count
            =
            exp
             exp1
              exp2
               exp3
                exp4
                 exp5
                  exp6
                   exp7
                    exp8
                     exp9
                      0
           ;
         statement
          executable
           keyword_statement
            start_scan_statement
             START
             SCAN
             scan_attr_list
              scan_attr_list
               scan_attr
                INPUT
                FILE
                exp
                 exp1
                  exp2
                   exp3
                    exp4
                     exp5
                      exp6
                       exp7
                        exp8
                         exp9
                          ref
                           id
                            in_file_name
              scan_attr
               OUTPUT
               FILE
               exp
                exp1
                 exp2
                  exp3
                   exp4
                    exp5
                     exp6
                      exp7
                       exp8
                        exp9
                         ref
                          id
                           out_file_name
          ;
        statement
         executable
          keyword_statement
           if_statement
            IF
            exp
             exp1
              exp2
               exp3
                exp3
                 exp4
                  exp5
                   exp6
                    exp7
                     exp8
                      exp9
                       ref
                        id
                         replacement_count
                =
                exp4
                 exp5
                  exp6
                   exp7
                    exp8
                     exp9
                      1
            THEN
            executable_list
             executable
              variable_ref
               var_ref
                write_id
                 id
                  plural_string
              =
              exp
               exp1
                exp2
                 exp3
                  exp4
                   exp5
                    exp6
                     exp7
                      exp8
                       exp9
                        string_literal
                         ''
             ;
            opt_else_statement
             ELSE
             executable_list
              executable
               variable_ref
                var_ref
                 write_id
                  id
                   plural_string
               =
               exp
                exp1
                 exp2
                  exp3
                   exp4
                    exp5
                     exp6
                      exp7
                       exp8
                        exp9
                         string_literal
                          's'
              ;
            END
            IF
         ;
       statement
        executable
         keyword_statement
          write_statement
           WRITE
           exp_list
            exp_list
             exp_list
              exp_list
               exp
                exp1
                 exp2
                  exp3
                   exp4
                    exp5
                     exp6
                      exp7
                       exp8
                        exp9
                         ref
                          id
                           replacement_count
              ,
              exp
               exp1
                exp2
                 exp3
                  exp4
                   exp5
                    exp6
                     exp7
                      exp8
                       exp9
                        string_literal
                         ' substitution'
             ,
             exp
              exp1
               exp2
                exp3
                 exp4
                  exp5
                   exp6
                    exp7
                     exp8
                      exp9
                       ref
                        id
                         plural_string
            ,
            exp
             exp1
              exp2
               exp3
                exp4
                 exp5
                  exp6
                   exp7
                    exp8
                     exp9
                      string_literal
                       ' performed.'
        ;
     END
     PROCEDURE
   ;
  module_statement
   procedure_declaration
    proc_start
     PROCEDURE
     id
      main
     opt_proc_attr
      MAIN
    ;
    body
     statement_list
      statement_list
       statement_list
        statement_list
         statement_list
          statement_list
           statement
            declaration
             variable_declaration
              DECLARE
              name_list
               name_list
                name_list
                 pic_id
                  id
                   file_spec
                ,
                pic_id
                 id
                  full_file_name
               ,
               pic_id
                id
                 file_name
              :
              type_dec
               STRING
            ;
          statement
           declaration
            variable_declaration
             DECLARE
             name_list
              pic_id
               id
                context
             :
             type_dec
              common_type_dec
               INTEGER
           ;
         statement
          executable
           keyword_statement
            read_statement
             READ
             prompt
              PROMPT
              (
              exp
               exp1
                exp2
                 exp3
                  exp4
                   exp5
                    exp6
                     exp7
                      exp8
                       exp9
                        string_literal
                         'Enter file specification to process: '
              )
             variable_ref
              var_ref
               write_id
                id
                 file_spec
          ;
        statement
         executable
          variable_ref
           var_ref
            write_id
             id
              context
          =
          exp
           exp1
            exp2
             exp3
              exp4
               exp5
                exp6
                 exp7
                  exp8
                   exp9
                    0
         ;
       statement
        executable
         keyword_statement
          while_statement
           WHILE
           exp
            exp1
             exp2
              exp3
               exp3
                exp4
                 exp5
                  exp6
                   exp7
                    exp8
                     exp9
                      (
                      exp
                       exp1
                        exp1
                         exp2
                          exp3
                           exp4
                            exp5
                             exp6
                              exp7
                               exp8
                                exp9
                                 ref
                                  ref
                                   id
                                    lib$find_file
                                  argument_list
                                   (
                                   arg_list
                                    arg_list
                                     arg_list
                                      arg
                                       exp
                                        exp1
                                         exp2
                                          exp3
                                           exp4
                                            exp5
                                             exp6
                                              exp7
                                               exp8
                                                exp9
                                                 ref
                                                  id
                                                   file_spec
                                     ,
                                     arg
                                      exp
                                       exp1
                                        exp2
                                         exp3
                                          exp4
                                           exp5
                                            exp6
                                             exp7
                                              exp8
                                               exp9
                                                ref
                                                 id
                                                  full_file_name
                                    ,
                                    arg
                                     exp
                                      exp1
                                       exp2
                                        exp3
                                         exp4
                                          exp5
                                           exp6
                                            exp7
                                             exp8
                                              exp9
                                               ref
                                                id
                                                 context
                                   )
                        AND
                        exp2
                         exp3
                          exp4
                           exp5
                            exp6
                             exp7
                              exp8
                               exp9
                                1
                      )
               =
               exp4
                exp5
                 exp6
                  exp7
                   exp8
                    exp9
                     1
           ;
           executable_list
            executable
             keyword_statement
              call_statement
               CALL
               id
                replace_file
               argument_list
                (
                arg_list
                 arg
                  exp
                   exp1
                    exp2
                     exp3
                      exp4
                       exp5
                        exp6
                         exp7
                          exp8
                           exp9
                            ref
                             id
                              full_file_name
                )
            ;
           END
           WHILE
        ;
      statement
       executable
        keyword_statement
         if_statement
          IF
          exp
           exp1
            exp2
             exp3
              exp3
               exp4
                exp5
                 exp6
                  exp7
                   exp8
                    exp9
                     (
                     exp
                      exp1
                       exp1
                        exp2
                         exp3
                          exp4
                           exp5
                            exp6
                             exp7
                              exp8
                               exp9
                                ref
                                 ref
                                  id
                                   lib$find_file_end
                                 argument_list
                                  (
                                  arg_list
                                   arg
                                    exp
                                     exp1
                                      exp2
                                       exp3
                                        exp4
                                         exp5
                                          exp6
                                           exp7
                                            exp8
                                             exp9
                                              ref
                                               id
                                                context
                                  )
                       AND
                       exp2
                        exp3
                         exp4
                          exp5
                           exp6
                            exp7
                             exp8
                              exp9
                               1
                     )
              <>
              exp4
               exp5
                exp6
                 exp7
                  exp8
                   exp9
                    1
          THEN
          executable_list
           executable
            keyword_statement
             write_statement
              WRITE
              exp_list
               exp
                exp1
                 exp2
                  exp3
                   exp4
                    exp5
                     exp6
                      exp7
                       exp8
                        exp9
                         string_literal
                          'Error freeing the find_file context.'
           ;
          opt_else_statement
          END
          IF
       ;
    END
    PROCEDURE
  ;
 end_module
  END
  MODULE
 ;
 <EOF>
