start_
 chunk
  block
   stat
    local
    attnamelist
     version
     attrib
    =
    explist
     exp
      string
       "Lua 5.4"
   stat
    if
    exp
     exp
      prefixexp
       _VERSION
     ~=
     exp
      prefixexp
       version
    then
    block
     stat
      functioncall
       io
       .
       stderr
       :
       write
       args
        (
        explist
         exp
          string
           "This test suite is for "
         ,
         exp
          prefixexp
           version
         ,
         exp
          string
           ", not for "
         ,
         exp
          prefixexp
           _VERSION
         ,
         exp
          string
           "\nExiting tests"
        )
     retstat
      return
    end
   stat
    varlist
     var
      prefixexp
       _G
      .
      ARG
    =
    explist
     exp
      prefixexp
       arg
   stat
    varlist
     var
      _soft
    =
    explist
     exp
      exp
       prefixexp
        functioncall
         rawget
         args
          (
          explist
           exp
            prefixexp
             _G
           ,
           exp
            string
             "_soft"
          )
      or
      exp
       false
   stat
    varlist
     var
      _port
    =
    explist
     exp
      exp
       prefixexp
        functioncall
         rawget
         args
          (
          explist
           exp
            prefixexp
             _G
           ,
           exp
            string
             "_port"
          )
      or
      exp
       false
   stat
    varlist
     var
      _nomsg
    =
    explist
     exp
      exp
       prefixexp
        functioncall
         rawget
         args
          (
          explist
           exp
            prefixexp
             _G
           ,
           exp
            string
             "_nomsg"
          )
      or
      exp
       false
   stat
    local
    attnamelist
     usertests
     attrib
    =
    explist
     exp
      prefixexp
       functioncall
        rawget
        args
         (
         explist
          exp
           prefixexp
            _G
          ,
          exp
           string
            "_U"
         )
   stat
    if
    exp
     prefixexp
      usertests
    then
    block
     stat
      varlist
       var
        _soft
      =
      explist
       exp
        true
     stat
      varlist
       var
        _port
      =
      explist
       exp
        true
     stat
      varlist
       var
        _nomsg
      =
      explist
       exp
        true
    end
   stat
    varlist
     var
      debug
    =
    explist
     exp
      nil
   stat
    if
    exp
     prefixexp
      usertests
    then
    block
     stat
      varlist
       var
        T
      =
      explist
       exp
        nil
    else
    block
     stat
      varlist
       var
        T
      =
      explist
       exp
        prefixexp
         functioncall
          rawget
          args
           (
           explist
            exp
             prefixexp
              _G
            ,
            exp
             string
              "T"
           )
    end
   stat
    functioncall
     print
     args
      (
      explist
       exp
        string
         "\n\tStarting Tests"
      )
   stat
    do
    block
     stat
      local
      attnamelist
       random_x
       attrib
       ,
       random_y
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          math
          .
          randomseed
          args
           (
           )
     stat
      functioncall
       print
       args
        (
        explist
         exp
          prefixexp
           functioncall
            string
            .
            format
            args
             (
             explist
              exp
               string
                "random seeds: %d, %d"
              ,
              exp
               prefixexp
                random_x
              ,
              exp
               prefixexp
                random_y
             )
        )
    end
   stat
    functioncall
     print
     args
      (
      explist
       exp
        exp
         string
          "current path:\n****"
        ..
        exp
         exp
          prefixexp
           package
           .
           path
         ..
         exp
          string
           "****\n"
      )
   stat
    local
    attnamelist
     initclock
     attrib
    =
    explist
     exp
      prefixexp
       functioncall
        os
        .
        clock
        args
         (
         )
   stat
    local
    attnamelist
     lastclock
     attrib
    =
    explist
     exp
      prefixexp
       initclock
   stat
    local
    attnamelist
     walltime
     attrib
    =
    explist
     exp
      prefixexp
       functioncall
        os
        .
        time
        args
         (
         )
   stat
    local
    attnamelist
     collectgarbage
     attrib
    =
    explist
     exp
      prefixexp
       collectgarbage
   stat
    do
    block
     stat
      local
      attnamelist
       msgs
       attrib
      =
      explist
       exp
        tableconstructor
         {
         }
     stat
      function
      funcname
       Message
      funcbody
       (
       parlist
        namelist
         m
       )
       block
        stat
         if
         exp
          not
          exp
           prefixexp
            _nomsg
         then
         block
          stat
           functioncall
            print
            args
             (
             explist
              exp
               prefixexp
                m
             )
          stat
           varlist
            var
             prefixexp
              msgs
             [
             exp
              exp
               #
               exp
                prefixexp
                 msgs
              +
              exp
               number
                1
             ]
           =
           explist
            exp
             prefixexp
              functioncall
               string
               .
               sub
               args
                (
                explist
                 exp
                  prefixexp
                   m
                 ,
                 exp
                  number
                   3
                 ,
                 exp
                  -
                  exp
                   number
                    3
                )
         end
       end
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          prefixexp
           functioncall
            os
            .
            setlocale
            args
             string
              "C"
        )
     stat
      local
      attnamelist
       T
       attrib
       ,
       print
       attrib
       ,
       format
       attrib
       ,
       write
       attrib
       ,
       assert
       attrib
       ,
       type
       attrib
       ,
       unpack
       attrib
       ,
       floor
       attrib
      =
      explist
       exp
        prefixexp
         T
       ,
       exp
        prefixexp
         print
       ,
       exp
        prefixexp
         string
         .
         format
       ,
       exp
        prefixexp
         io
         .
         write
       ,
       exp
        prefixexp
         assert
       ,
       exp
        prefixexp
         type
       ,
       exp
        prefixexp
         table
         .
         unpack
       ,
       exp
        prefixexp
         math
         .
         floor
     stat
      local
      function
      F
      funcbody
       (
       parlist
        namelist
         m
       )
       block
        stat
         local
         function
         round
         funcbody
          (
          parlist
           namelist
            m
          )
          block
           stat
            varlist
             var
              m
            =
            explist
             exp
              exp
               prefixexp
                m
              +
              exp
               number
                0.04999
           retstat
            return
            explist
             exp
              prefixexp
               functioncall
                format
                args
                 (
                 explist
                  exp
                   string
                    "%.1f"
                  ,
                  exp
                   prefixexp
                    m
                 )
          end
        stat
         if
         exp
          exp
           prefixexp
            m
          <
          exp
           number
            1000
         then
         block
          retstat
           return
           explist
            exp
             prefixexp
              m
         else
         block
          stat
           varlist
            var
             m
           =
           explist
            exp
             exp
              prefixexp
               m
             /
             exp
              number
               1000
          stat
           if
           exp
            exp
             prefixexp
              m
            <
            exp
             number
              1000
           then
           block
            retstat
             return
             explist
              exp
               exp
                prefixexp
                 functioncall
                  round
                  args
                   (
                   explist
                    exp
                     prefixexp
                      m
                   )
               ..
               exp
                string
                 "K"
           else
           block
            retstat
             return
             explist
              exp
               exp
                prefixexp
                 functioncall
                  round
                  args
                   (
                   explist
                    exp
                     exp
                      prefixexp
                       m
                     /
                     exp
                      number
                       1000
                   )
               ..
               exp
                string
                 "M"
           end
         end
       end
     stat
      local
      attnamelist
       Cstacklevel
       attrib
     stat
      local
      attnamelist
       showmem
       attrib
     stat
      if
      exp
       not
       exp
        prefixexp
         T
      then
      block
       stat
        local
        attnamelist
         max
         attrib
        =
        explist
         exp
          number
           0
       stat
        varlist
         var
          showmem
        =
        explist
         exp
          functiondef
           function
           funcbody
            (
            parlist
            )
            block
             stat
              local
              attnamelist
               m
               attrib
              =
              explist
               exp
                exp
                 prefixexp
                  functioncall
                   collectgarbage
                   args
                    (
                    explist
                     exp
                      string
                       "count"
                    )
                *
                exp
                 number
                  1024
             stat
              varlist
               var
                max
              =
              explist
               exp
                exp
                 exp
                  prefixexp
                   (
                   exp
                    exp
                     prefixexp
                      m
                    >
                    exp
                     prefixexp
                      max
                   )
                 and
                 exp
                  prefixexp
                   m
                or
                exp
                 prefixexp
                  max
             stat
              functioncall
               print
               args
                (
                explist
                 exp
                  prefixexp
                   functioncall
                    format
                    args
                     (
                     explist
                      exp
                       string
                        "    ---- total memory: %s, max memory: %s ----\n"
                      ,
                      exp
                       prefixexp
                        functioncall
                         F
                         args
                          (
                          explist
                           exp
                            prefixexp
                             m
                          )
                      ,
                      exp
                       prefixexp
                        functioncall
                         F
                         args
                          (
                          explist
                           exp
                            prefixexp
                             max
                          )
                     )
                )
            end
       stat
        varlist
         var
          Cstacklevel
        =
        explist
         exp
          functiondef
           function
           funcbody
            (
            parlist
            )
            block
             retstat
              return
              explist
               exp
                number
                 0
            end
      else
      block
       stat
        varlist
         var
          showmem
        =
        explist
         exp
          functiondef
           function
           funcbody
            (
            parlist
            )
            block
             stat
              functioncall
               T
               .
               checkmemory
               args
                (
                )
             stat
              local
              attnamelist
               total
               attrib
               ,
               numblocks
               attrib
               ,
               maxmem
               attrib
              =
              explist
               exp
                prefixexp
                 functioncall
                  T
                  .
                  totalmem
                  args
                   (
                   )
             stat
              local
              attnamelist
               count
               attrib
              =
              explist
               exp
                prefixexp
                 functioncall
                  collectgarbage
                  args
                   (
                   explist
                    exp
                     string
                      "count"
                   )
             stat
              functioncall
               print
               args
                (
                explist
                 exp
                  prefixexp
                   functioncall
                    format
                    args
                     (
                     explist
                      exp
                       string
                        "\n    ---- total memory: %s (%.0fK), max use: %s,  blocks: %d\n"
                      ,
                      exp
                       prefixexp
                        functioncall
                         F
                         args
                          (
                          explist
                           exp
                            prefixexp
                             total
                          )
                      ,
                      exp
                       prefixexp
                        count
                      ,
                      exp
                       prefixexp
                        functioncall
                         F
                         args
                          (
                          explist
                           exp
                            prefixexp
                             maxmem
                          )
                      ,
                      exp
                       prefixexp
                        numblocks
                     )
                )
             stat
              functioncall
               print
               args
                (
                explist
                 exp
                  prefixexp
                   functioncall
                    format
                    args
                     (
                     explist
                      exp
                       exp
                        string
                         "\t(strings:  %d, tables: %d, functions: %d, "
                       ..
                       exp
                        string
                         "\n\tudata: %d, threads: %d)"
                      ,
                      exp
                       prefixexp
                        functioncall
                         T
                         .
                         totalmem
                         args
                          string
                           "string"
                      ,
                      exp
                       prefixexp
                        functioncall
                         T
                         .
                         totalmem
                         args
                          string
                           "table"
                      ,
                      exp
                       prefixexp
                        functioncall
                         T
                         .
                         totalmem
                         args
                          string
                           "function"
                      ,
                      exp
                       prefixexp
                        functioncall
                         T
                         .
                         totalmem
                         args
                          string
                           "userdata"
                      ,
                      exp
                       prefixexp
                        functioncall
                         T
                         .
                         totalmem
                         args
                          string
                           "thread"
                     )
                )
            end
       stat
        varlist
         var
          Cstacklevel
        =
        explist
         exp
          functiondef
           function
           funcbody
            (
            parlist
            )
            block
             stat
              local
              attnamelist
               _
               attrib
               ,
               _
               attrib
               ,
               ncalls
               attrib
              =
              explist
               exp
                prefixexp
                 functioncall
                  T
                  .
                  stacklevel
                  args
                   (
                   )
             retstat
              return
              explist
               exp
                prefixexp
                 ncalls
            end
      end
     stat
      local
      attnamelist
       Cstack
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          Cstacklevel
          args
           (
           )
     stat
      local
      function
      report
      funcbody
       (
       parlist
        namelist
         n
       )
       block
        stat
         functioncall
          print
          args
           (
           explist
            exp
             exp
              string
               "\n***** FILE '"
             ..
             exp
              exp
               prefixexp
                n
              ..
              exp
               string
                "'*****"
           )
       end
     stat
      local
      attnamelist
       olddofile
       attrib
      =
      explist
       exp
        prefixexp
         dofile
     stat
      local
      attnamelist
       dofile
       attrib
      =
      explist
       exp
        functiondef
         function
         funcbody
          (
          parlist
           namelist
            n
            ,
            strip
          )
          block
           stat
            functioncall
             showmem
             args
              (
              )
           stat
            local
            attnamelist
             c
             attrib
            =
            explist
             exp
              prefixexp
               functioncall
                os
                .
                clock
                args
                 (
                 )
           stat
            functioncall
             print
             args
              (
              explist
               exp
                prefixexp
                 functioncall
                  string
                  .
                  format
                  args
                   (
                   explist
                    exp
                     string
                      "time: %g (+%g)"
                    ,
                    exp
                     exp
                      prefixexp
                       c
                     -
                     exp
                      prefixexp
                       initclock
                    ,
                    exp
                     exp
                      prefixexp
                       c
                     -
                     exp
                      prefixexp
                       lastclock
                   )
              )
           stat
            varlist
             var
              lastclock
            =
            explist
             exp
              prefixexp
               c
           stat
            functioncall
             report
             args
              (
              explist
               exp
                prefixexp
                 n
              )
           stat
            local
            attnamelist
             f
             attrib
            =
            explist
             exp
              prefixexp
               functioncall
                assert
                args
                 (
                 explist
                  exp
                   prefixexp
                    functioncall
                     loadfile
                     args
                      (
                      explist
                       exp
                        prefixexp
                         n
                      )
                 )
           stat
            local
            attnamelist
             b
             attrib
            =
            explist
             exp
              prefixexp
               functioncall
                string
                .
                dump
                args
                 (
                 explist
                  exp
                   prefixexp
                    f
                  ,
                  exp
                   prefixexp
                    strip
                 )
           stat
            varlist
             var
              f
            =
            explist
             exp
              prefixexp
               functioncall
                assert
                args
                 (
                 explist
                  exp
                   prefixexp
                    functioncall
                     load
                     args
                      (
                      explist
                       exp
                        prefixexp
                         b
                      )
                 )
           retstat
            return
            explist
             exp
              prefixexp
               functioncall
                f
                args
                 (
                 )
          end
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'main.lua'
        )
     stat
      functioncall
       functioncall
        require
        args
         string
          "tracegc"
       .
       start
       args
        (
        )
     stat
      functioncall
       report
       args
        string
         "gc.lua"
     stat
      local
      attnamelist
       f
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          assert
          args
           (
           explist
            exp
             prefixexp
              functioncall
               loadfile
               args
                (
                explist
                 exp
                  string
                   'gc.lua'
                )
           )
     stat
      functioncall
       f
       args
        (
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'db.lua'
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           exp
            prefixexp
             functioncall
              dofile
              args
               (
               explist
                exp
                 string
                  'calls.lua'
               )
           ==
           exp
            prefixexp
             deep
          and
          exp
           prefixexp
            deep
        )
     stat
      varlist
       var
        prefixexp
         _G
        .
        deep
      =
      explist
       exp
        nil
     stat
      functioncall
       olddofile
       args
        (
        explist
         exp
          string
           'strings.lua'
        )
     stat
      functioncall
       olddofile
       args
        (
        explist
         exp
          string
           'literals.lua'
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'tpack.lua'
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             dofile
             args
              (
              explist
               exp
                string
                 'attrib.lua'
              )
          ==
          exp
           number
            27
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'gengc.lua'
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             dofile
             args
              (
              explist
               exp
                string
                 'locals.lua'
              )
          ==
          exp
           number
            5
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'constructs.lua'
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'code.lua'
         ,
         exp
          true
        )
     stat
      if
      exp
       not
       exp
        prefixexp
         _G
         .
         _soft
      then
      block
       stat
        functioncall
         report
         args
          (
          explist
           exp
            string
             'big.lua'
          )
       stat
        local
        attnamelist
         f
         attrib
        =
        explist
         exp
          prefixexp
           functioncall
            coroutine
            .
            wrap
            args
             (
             explist
              exp
               prefixexp
                functioncall
                 assert
                 args
                  (
                  explist
                   exp
                    prefixexp
                     functioncall
                      loadfile
                      args
                       (
                       explist
                        exp
                         string
                          'big.lua'
                       )
                  )
             )
       stat
        functioncall
         assert
         args
          (
          explist
           exp
            exp
             prefixexp
              functioncall
               f
               args
                (
                )
            ==
            exp
             string
              'b'
          )
       stat
        functioncall
         assert
         args
          (
          explist
           exp
            exp
             prefixexp
              functioncall
               f
               args
                (
                )
            ==
            exp
             string
              'a'
          )
      end
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'cstack.lua'
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'nextvar.lua'
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'pm.lua'
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'utf8.lua'
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'api.lua'
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             dofile
             args
              (
              explist
               exp
                string
                 'events.lua'
              )
          ==
          exp
           number
            12
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'vararg.lua'
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'closure.lua'
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'coroutine.lua'
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'goto.lua'
         ,
         exp
          true
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'errors.lua'
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'math.lua'
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'sort.lua'
         ,
         exp
          true
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'bitwise.lua'
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             dofile
             args
              (
              explist
               exp
                string
                 'verybig.lua'
               ,
               exp
                true
              )
          ==
          exp
           number
            10
        )
     stat
      ;
     stat
      functioncall
       collectgarbage
       args
        (
        )
     stat
      functioncall
       dofile
       args
        (
        explist
         exp
          string
           'files.lua'
        )
     stat
      if
      exp
       exp
        #
        exp
         prefixexp
          msgs
       >
       exp
        number
         0
      then
      block
       stat
        local
        attnamelist
         m
         attrib
        =
        explist
         exp
          prefixexp
           functioncall
            table
            .
            concat
            args
             (
             explist
              exp
               prefixexp
                msgs
              ,
              exp
               string
                "\n  "
             )
       stat
        functioncall
         warn
         args
          (
          explist
           exp
            string
             "#tests not performed:\n  "
           ,
           exp
            prefixexp
             m
           ,
           exp
            string
             "\n"
          )
      end
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "(there should be two warnings now)"
        )
     stat
      functioncall
       warn
       args
        (
        explist
         exp
          string
           "@on"
        )
     stat
      functioncall
       warn
       args
        (
        explist
         exp
          string
           "#This is "
         ,
         exp
          string
           "an expected"
         ,
         exp
          string
           " warning"
        )
     stat
      functioncall
       warn
       args
        (
        explist
         exp
          string
           "@off"
        )
     stat
      functioncall
       warn
       args
        (
        explist
         exp
          string
           "******** THIS WARNING SHOULD NOT APPEAR **********"
        )
     stat
      functioncall
       warn
       args
        (
        explist
         exp
          string
           "******** THIS WARNING ALSO SHOULD NOT APPEAR **********"
        )
     stat
      functioncall
       warn
       args
        (
        explist
         exp
          string
           "@on"
        )
     stat
      functioncall
       warn
       args
        (
        explist
         exp
          string
           "#This is"
         ,
         exp
          string
           " another one"
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            debug
          ==
          exp
           nil
        )
     stat
      local
      attnamelist
       debug
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          require
          args
           string
            "debug"
     stat
      functioncall
       print
       args
        (
        explist
         exp
          prefixexp
           functioncall
            string
            .
            format
            args
             (
             explist
              exp
               string
                "%d-bit integers, %d-bit floats"
              ,
              exp
               exp
                prefixexp
                 functioncall
                  string
                  .
                  packsize
                  args
                   (
                   explist
                    exp
                     string
                      "j"
                   )
               *
               exp
                number
                 8
              ,
              exp
               exp
                prefixexp
                 functioncall
                  string
                  .
                  packsize
                  args
                   (
                   explist
                    exp
                     string
                      "n"
                   )
               *
               exp
                number
                 8
             )
        )
     stat
      functioncall
       debug
       .
       sethook
       args
        (
        explist
         exp
          functiondef
           function
           funcbody
            (
            parlist
             namelist
              a
            )
            block
             stat
              functioncall
               assert
               args
                (
                explist
                 exp
                  exp
                   prefixexp
                    functioncall
                     type
                     args
                      (
                      explist
                       exp
                        prefixexp
                         a
                      )
                  ==
                  exp
                   string
                    'string'
                )
            end
         ,
         exp
          string
           "cr"
        )
     stat
      varlist
       var
        prefixexp
         _G
        .
        showmem
      =
      explist
       exp
        prefixexp
         showmem
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            Cstack
          ==
          exp
           prefixexp
            functioncall
             Cstacklevel
             args
              (
              )
         ,
         exp
          string
           "should be at the same C-stack level it was when started the tests"
        )
    end
   stat
    local
    attnamelist
     _G
     attrib
     ,
     showmem
     attrib
     ,
     print
     attrib
     ,
     format
     attrib
     ,
     clock
     attrib
     ,
     time
     attrib
     ,
     difftime
     attrib
     ,
     assert
     attrib
     ,
     open
     attrib
     ,
     warn
     attrib
    =
    explist
     exp
      prefixexp
       _G
     ,
     exp
      prefixexp
       showmem
     ,
     exp
      prefixexp
       print
     ,
     exp
      prefixexp
       string
       .
       format
     ,
     exp
      prefixexp
       os
       .
       clock
     ,
     exp
      prefixexp
       os
       .
       time
     ,
     exp
      prefixexp
       os
       .
       difftime
     ,
     exp
      prefixexp
       assert
     ,
     exp
      prefixexp
       io
       .
       open
     ,
     exp
      prefixexp
       warn
   stat
    local
    attnamelist
     fname
     attrib
    =
    explist
     exp
      exp
       exp
        prefixexp
         T
       and
       exp
        string
         "time-debug.txt"
      or
      exp
       string
        "time.txt"
   stat
    local
    attnamelist
     lasttime
     attrib
   stat
    if
    exp
     not
     exp
      prefixexp
       usertests
    then
    block
     stat
      local
      attnamelist
       f
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          io
          .
          open
          args
           (
           explist
            exp
             prefixexp
              fname
           )
     stat
      if
      exp
       prefixexp
        f
      then
      block
       stat
        varlist
         var
          lasttime
        =
        explist
         exp
          prefixexp
           functioncall
            assert
            args
             (
             explist
              exp
               prefixexp
                functioncall
                 tonumber
                 args
                  (
                  explist
                   exp
                    prefixexp
                     functioncall
                      f
                      :
                      read
                      args
                       string
                        'a'
                  )
             )
       stat
        functioncall
         f
         :
         close
         args
          (
          )
       stat
        ;
      else
      block
       stat
        varlist
         var
          lasttime
        =
        explist
         exp
          nil
      end
    end
   stat
    functioncall
     print
     args
      (
      explist
       exp
        string
         'cleaning all!!!!'
      )
   stat
    for
    namelist
     n
    in
    explist
     exp
      prefixexp
       functioncall
        pairs
        args
         (
         explist
          exp
           prefixexp
            _G
         )
    do
    block
     stat
      if
      exp
       not
       exp
        prefixexp
         (
         exp
          tableconstructor
           {
           fieldlist
            field
             ___Glob
             =
             exp
              number
               1
            fieldsep
             ,
            field
             tostring
             =
             exp
              number
               1
           }
         )
         [
         exp
          prefixexp
           n
         ]
      then
      block
       stat
        varlist
         var
          prefixexp
           _G
          [
          exp
           prefixexp
            n
          ]
        =
        explist
         exp
          prefixexp
           undef
      end
    end
   stat
    functioncall
     collectgarbage
     args
      (
      )
   stat
    functioncall
     collectgarbage
     args
      (
      )
   stat
    functioncall
     collectgarbage
     args
      (
      )
   stat
    functioncall
     collectgarbage
     args
      (
      )
   stat
    functioncall
     collectgarbage
     args
      (
      )
   stat
    functioncall
     collectgarbage
     args
      (
      )
   stat
    ;
   stat
    functioncall
     showmem
     args
      (
      )
   stat
    local
    attnamelist
     clocktime
     attrib
    =
    explist
     exp
      exp
       prefixexp
        functioncall
         clock
         args
          (
          )
      -
      exp
       prefixexp
        initclock
   stat
    varlist
     var
      walltime
    =
    explist
     exp
      prefixexp
       functioncall
        difftime
        args
         (
         explist
          exp
           prefixexp
            functioncall
             time
             args
              (
              )
          ,
          exp
           prefixexp
            walltime
         )
   stat
    functioncall
     print
     args
      (
      explist
       exp
        prefixexp
         functioncall
          format
          args
           (
           explist
            exp
             string
              "\n\ntotal time: %.2fs (wall time: %gs)\n"
            ,
            exp
             prefixexp
              clocktime
            ,
            exp
             prefixexp
              walltime
           )
      )
   stat
    if
    exp
     not
     exp
      prefixexp
       usertests
    then
    block
     stat
      varlist
       var
        lasttime
      =
      explist
       exp
        exp
         prefixexp
          lasttime
        or
        exp
         prefixexp
          clocktime
     stat
      local
      attnamelist
       diff
       attrib
      =
      explist
       exp
        exp
         prefixexp
          (
          exp
           exp
            prefixexp
             clocktime
           -
           exp
            prefixexp
             lasttime
          )
        /
        exp
         prefixexp
          lasttime
     stat
      local
      attnamelist
       tolerance
       attrib
      =
      explist
       exp
        number
         0.05
     stat
      if
      exp
       prefixexp
        (
        exp
         exp
          exp
           prefixexp
            diff
          >=
          exp
           prefixexp
            tolerance
         or
         exp
          exp
           prefixexp
            diff
          <=
          exp
           -
           exp
            prefixexp
             tolerance
        )
      then
      block
       stat
        functioncall
         warn
         args
          (
          explist
           exp
            prefixexp
             functioncall
              format
              args
               (
               explist
                exp
                 string
                  "#time difference from previous test: %+.1f%%"
                ,
                exp
                 exp
                  prefixexp
                   diff
                 *
                 exp
                  number
                   100
               )
          )
      end
     stat
      functioncall
       functioncall
        functioncall
         assert
         args
          (
          explist
           exp
            prefixexp
             functioncall
              open
              args
               (
               explist
                exp
                 prefixexp
                  fname
                ,
                exp
                 string
                  "w"
               )
          )
        :
        write
        args
         (
         explist
          exp
           prefixexp
            clocktime
         )
       :
       close
       args
        (
        )
    end
   stat
    functioncall
     print
     args
      (
      explist
       exp
        string
         "final OK !!!"
      )
 <EOF>
