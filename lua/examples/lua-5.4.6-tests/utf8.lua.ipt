start_
 chunk
  block
   stat
    functioncall
     print
     args
      string
       "testing UTF-8 library"
   stat
    local
    attnamelist
     utf8
     attrib
    =
    explist
     exp
      prefixexp
       functioncall
        require
        args
         string
          'utf8'
   stat
    local
    function
    checkerror
    funcbody
     (
     parlist
      namelist
       msg
       ,
       f
      ,
      ...
     )
     block
      stat
       local
       attnamelist
        s
        attrib
        ,
        err
        attrib
       =
       explist
        exp
         prefixexp
          functioncall
           pcall
           args
            (
            explist
             exp
              prefixexp
               f
             ,
             exp
              ...
            )
      stat
       functioncall
        assert
        args
         (
         explist
          exp
           exp
            not
            exp
             prefixexp
              s
           and
           exp
            prefixexp
             functioncall
              string
              .
              find
              args
               (
               explist
                exp
                 prefixexp
                  err
                ,
                exp
                 prefixexp
                  msg
               )
         )
     end
   stat
    local
    function
    len
    funcbody
     (
     parlist
      namelist
       s
     )
     block
      retstat
       return
       explist
        exp
         #
         exp
          prefixexp
           functioncall
            string
            .
            gsub
            args
             (
             explist
              exp
               prefixexp
                s
              ,
              exp
               string
                "[\x80-\xBF]"
              ,
              exp
               string
                ""
             )
     end
   stat
    local
    attnamelist
     justone
     attrib
    =
    explist
     exp
      exp
       string
        "^"
      ..
      exp
       exp
        prefixexp
         utf8
         .
         charpattern
       ..
       exp
        string
         "$"
   stat
    local
    function
    checksyntax
    funcbody
     (
     parlist
      namelist
       s
       ,
       t
     )
     block
      stat
       local
       attnamelist
        ts
        attrib
       =
       explist
        exp
         tableconstructor
          {
          fieldlist
           field
            exp
             string
              "return '"
          }
      stat
       for
       i
       =
       exp
        number
         1
       ,
       exp
        #
        exp
         prefixexp
          t
       do
       block
        stat
         varlist
          var
           prefixexp
            ts
           [
           exp
            exp
             prefixexp
              i
            +
            exp
             number
              1
           ]
         =
         explist
          exp
           prefixexp
            functioncall
             string
             .
             format
             args
              (
              explist
               exp
                string
                 "\\u{%x}"
               ,
               exp
                prefixexp
                 t
                 [
                 exp
                  prefixexp
                   i
                 ]
              )
       end
      stat
       varlist
        var
         prefixexp
          ts
         [
         exp
          exp
           #
           exp
            prefixexp
             t
          +
          exp
           number
            2
         ]
       =
       explist
        exp
         string
          "'"
      stat
       varlist
        var
         ts
       =
       explist
        exp
         prefixexp
          functioncall
           table
           .
           concat
           args
            (
            explist
             exp
              prefixexp
               ts
            )
      stat
       functioncall
        assert
        args
         (
         explist
          exp
           exp
            prefixexp
             functioncall
              functioncall
               assert
               args
                (
                explist
                 exp
                  prefixexp
                   functioncall
                    load
                    args
                     (
                     explist
                      exp
                       prefixexp
                        ts
                     )
                )
              args
               (
               )
           ==
           exp
            prefixexp
             s
         )
     end
   stat
    functioncall
     assert
     args
      (
      explist
       exp
        not
        exp
         prefixexp
          functioncall
           utf8
           .
           offset
           args
            (
            explist
             exp
              string
               "alo"
             ,
             exp
              number
               5
            )
      )
   stat
    functioncall
     assert
     args
      (
      explist
       exp
        not
        exp
         prefixexp
          functioncall
           utf8
           .
           offset
           args
            (
            explist
             exp
              string
               "alo"
             ,
             exp
              -
              exp
               number
                4
            )
      )
   stat
    local
    function
    check
    funcbody
     (
     parlist
      namelist
       s
       ,
       t
       ,
       nonstrict
     )
     block
      stat
       local
       attnamelist
        l
        attrib
       =
       explist
        exp
         prefixexp
          functioncall
           utf8
           .
           len
           args
            (
            explist
             exp
              prefixexp
               s
             ,
             exp
              number
               1
             ,
             exp
              -
              exp
               number
                1
             ,
             exp
              prefixexp
               nonstrict
            )
      stat
       functioncall
        assert
        args
         (
         explist
          exp
           exp
            exp
             #
             exp
              prefixexp
               t
            ==
            exp
             prefixexp
              l
           and
           exp
            exp
             prefixexp
              functioncall
               len
               args
                (
                explist
                 exp
                  prefixexp
                   s
                )
            ==
            exp
             prefixexp
              l
         )
      stat
       functioncall
        assert
        args
         (
         explist
          exp
           exp
            prefixexp
             functioncall
              utf8
              .
              char
              args
               (
               explist
                exp
                 prefixexp
                  functioncall
                   table
                   .
                   unpack
                   args
                    (
                    explist
                     exp
                      prefixexp
                       t
                    )
               )
           ==
           exp
            prefixexp
             s
         )
      stat
       functioncall
        assert
        args
         (
         explist
          exp
           exp
            prefixexp
             functioncall
              utf8
              .
              offset
              args
               (
               explist
                exp
                 prefixexp
                  s
                ,
                exp
                 number
                  0
               )
           ==
           exp
            number
             1
         )
      stat
       functioncall
        checksyntax
        args
         (
         explist
          exp
           prefixexp
            s
          ,
          exp
           prefixexp
            t
         )
      stat
       local
       attnamelist
        t1
        attrib
       =
       explist
        exp
         tableconstructor
          {
          fieldlist
           field
            exp
             prefixexp
              functioncall
               utf8
               .
               codepoint
               args
                (
                explist
                 exp
                  prefixexp
                   s
                 ,
                 exp
                  number
                   1
                 ,
                 exp
                  -
                  exp
                   number
                    1
                 ,
                 exp
                  prefixexp
                   nonstrict
                )
          }
      stat
       functioncall
        assert
        args
         (
         explist
          exp
           exp
            #
            exp
             prefixexp
              t
           ==
           exp
            #
            exp
             prefixexp
              t1
         )
      stat
       for
       i
       =
       exp
        number
         1
       ,
       exp
        #
        exp
         prefixexp
          t
       do
       block
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               t
               [
               exp
                prefixexp
                 i
               ]
             ==
             exp
              prefixexp
               t1
               [
               exp
                prefixexp
                 i
               ]
           )
       end
      stat
       for
       i
       =
       exp
        number
         1
       ,
       exp
        prefixexp
         l
       do
       block
        stat
         local
         attnamelist
          pi
          attrib
         =
         explist
          exp
           prefixexp
            functioncall
             utf8
             .
             offset
             args
              (
              explist
               exp
                prefixexp
                 s
               ,
               exp
                prefixexp
                 i
              )
        stat
         local
         attnamelist
          pi1
          attrib
         =
         explist
          exp
           prefixexp
            functioncall
             utf8
             .
             offset
             args
              (
              explist
               exp
                prefixexp
                 s
               ,
               exp
                number
                 2
               ,
               exp
                prefixexp
                 pi
              )
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             prefixexp
              functioncall
               string
               .
               find
               args
                (
                explist
                 exp
                  prefixexp
                   functioncall
                    string
                    .
                    sub
                    args
                     (
                     explist
                      exp
                       prefixexp
                        s
                      ,
                      exp
                       prefixexp
                        pi
                      ,
                      exp
                       exp
                        prefixexp
                         pi1
                       -
                       exp
                        number
                         1
                     )
                 ,
                 exp
                  prefixexp
                   justone
                )
           )
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               functioncall
                utf8
                .
                offset
                args
                 (
                 explist
                  exp
                   prefixexp
                    s
                  ,
                  exp
                   -
                   exp
                    number
                     1
                  ,
                  exp
                   prefixexp
                    pi1
                 )
             ==
             exp
              prefixexp
               pi
           )
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               functioncall
                utf8
                .
                offset
                args
                 (
                 explist
                  exp
                   prefixexp
                    s
                  ,
                  exp
                   exp
                    exp
                     prefixexp
                      i
                    -
                    exp
                     prefixexp
                      l
                   -
                   exp
                    number
                     1
                 )
             ==
             exp
              prefixexp
               pi
           )
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              exp
               prefixexp
                pi1
              -
              exp
               prefixexp
                pi
             ==
             exp
              #
              exp
               prefixexp
                functioncall
                 utf8
                 .
                 char
                 args
                  (
                  explist
                   exp
                    prefixexp
                     functioncall
                      utf8
                      .
                      codepoint
                      args
                       (
                       explist
                        exp
                         prefixexp
                          s
                        ,
                        exp
                         prefixexp
                          pi
                        ,
                        exp
                         prefixexp
                          pi
                        ,
                        exp
                         prefixexp
                          nonstrict
                       )
                  )
           )
        stat
         for
         j
         =
         exp
          prefixexp
           pi
         ,
         exp
          exp
           prefixexp
            pi1
          -
          exp
           number
            1
         do
         block
          stat
           functioncall
            assert
            args
             (
             explist
              exp
               exp
                prefixexp
                 functioncall
                  utf8
                  .
                  offset
                  args
                   (
                   explist
                    exp
                     prefixexp
                      s
                    ,
                    exp
                     number
                      0
                    ,
                    exp
                     prefixexp
                      j
                   )
               ==
               exp
                prefixexp
                 pi
             )
         end
        stat
         for
         j
         =
         exp
          exp
           prefixexp
            pi
          +
          exp
           number
            1
         ,
         exp
          exp
           prefixexp
            pi1
          -
          exp
           number
            1
         do
         block
          stat
           functioncall
            assert
            args
             (
             explist
              exp
               not
               exp
                prefixexp
                 functioncall
                  utf8
                  .
                  len
                  args
                   (
                   explist
                    exp
                     prefixexp
                      s
                    ,
                    exp
                     prefixexp
                      j
                   )
             )
         end
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               functioncall
                utf8
                .
                len
                args
                 (
                 explist
                  exp
                   prefixexp
                    s
                  ,
                  exp
                   prefixexp
                    pi
                  ,
                  exp
                   prefixexp
                    pi
                  ,
                  exp
                   prefixexp
                    nonstrict
                 )
             ==
             exp
              number
               1
           )
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               functioncall
                utf8
                .
                len
                args
                 (
                 explist
                  exp
                   prefixexp
                    s
                  ,
                  exp
                   prefixexp
                    pi
                  ,
                  exp
                   exp
                    prefixexp
                     pi1
                   -
                   exp
                    number
                     1
                  ,
                  exp
                   prefixexp
                    nonstrict
                 )
             ==
             exp
              number
               1
           )
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               functioncall
                utf8
                .
                len
                args
                 (
                 explist
                  exp
                   prefixexp
                    s
                  ,
                  exp
                   prefixexp
                    pi
                  ,
                  exp
                   -
                   exp
                    number
                     1
                  ,
                  exp
                   prefixexp
                    nonstrict
                 )
             ==
             exp
              exp
               exp
                prefixexp
                 l
               -
               exp
                prefixexp
                 i
              +
              exp
               number
                1
           )
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               functioncall
                utf8
                .
                len
                args
                 (
                 explist
                  exp
                   prefixexp
                    s
                  ,
                  exp
                   prefixexp
                    pi1
                  ,
                  exp
                   -
                   exp
                    number
                     1
                  ,
                  exp
                   prefixexp
                    nonstrict
                 )
             ==
             exp
              exp
               prefixexp
                l
              -
              exp
               prefixexp
                i
           )
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               functioncall
                utf8
                .
                len
                args
                 (
                 explist
                  exp
                   prefixexp
                    s
                  ,
                  exp
                   number
                    1
                  ,
                  exp
                   prefixexp
                    pi
                  ,
                  exp
                   prefixexp
                    nonstrict
                 )
             ==
             exp
              prefixexp
               i
           )
       end
      stat
       local
       attnamelist
        i
        attrib
       =
       explist
        exp
         number
          0
      stat
       for
       namelist
        p
        ,
        c
       in
       explist
        exp
         prefixexp
          functioncall
           utf8
           .
           codes
           args
            (
            explist
             exp
              prefixexp
               s
             ,
             exp
              prefixexp
               nonstrict
            )
       do
       block
        stat
         varlist
          var
           i
         =
         explist
          exp
           exp
            prefixexp
             i
           +
           exp
            number
             1
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              exp
               prefixexp
                c
              ==
              exp
               prefixexp
                t
                [
                exp
                 prefixexp
                  i
                ]
             and
             exp
              exp
               prefixexp
                p
              ==
              exp
               prefixexp
                functioncall
                 utf8
                 .
                 offset
                 args
                  (
                  explist
                   exp
                    prefixexp
                     s
                   ,
                   exp
                    prefixexp
                     i
                  )
           )
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               functioncall
                utf8
                .
                codepoint
                args
                 (
                 explist
                  exp
                   prefixexp
                    s
                  ,
                  exp
                   prefixexp
                    p
                  ,
                  exp
                   prefixexp
                    p
                  ,
                  exp
                   prefixexp
                    nonstrict
                 )
             ==
             exp
              prefixexp
               c
           )
       end
      stat
       functioncall
        assert
        args
         (
         explist
          exp
           exp
            prefixexp
             i
           ==
           exp
            #
            exp
             prefixexp
              t
         )
      stat
       varlist
        var
         i
       =
       explist
        exp
         number
          0
      stat
       for
       namelist
        c
       in
       explist
        exp
         prefixexp
          functioncall
           string
           .
           gmatch
           args
            (
            explist
             exp
              prefixexp
               s
             ,
             exp
              prefixexp
               utf8
               .
               charpattern
            )
       do
       block
        stat
         varlist
          var
           i
         =
         explist
          exp
           exp
            prefixexp
             i
           +
           exp
            number
             1
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               c
             ==
             exp
              prefixexp
               functioncall
                utf8
                .
                char
                args
                 (
                 explist
                  exp
                   prefixexp
                    t
                    [
                    exp
                     prefixexp
                      i
                    ]
                 )
           )
       end
      stat
       functioncall
        assert
        args
         (
         explist
          exp
           exp
            prefixexp
             i
           ==
           exp
            #
            exp
             prefixexp
              t
         )
      stat
       for
       i
       =
       exp
        number
         1
       ,
       exp
        prefixexp
         l
       do
       block
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               functioncall
                utf8
                .
                offset
                args
                 (
                 explist
                  exp
                   prefixexp
                    s
                  ,
                  exp
                   prefixexp
                    i
                 )
             ==
             exp
              prefixexp
               functioncall
                utf8
                .
                offset
                args
                 (
                 explist
                  exp
                   prefixexp
                    s
                  ,
                  exp
                   exp
                    exp
                     prefixexp
                      i
                    -
                    exp
                     prefixexp
                      l
                   -
                   exp
                    number
                     1
                  ,
                  exp
                   exp
                    #
                    exp
                     prefixexp
                      s
                   +
                   exp
                    number
                     1
                 )
           )
       end
     end
   stat
    do
    block
     stat
      local
      function
      check
      funcbody
       (
       parlist
        namelist
         s
         ,
         p
       )
       block
        stat
         local
         attnamelist
          a
          attrib
          ,
          b
          attrib
         =
         explist
          exp
           prefixexp
            functioncall
             utf8
             .
             len
             args
              (
              explist
               exp
                prefixexp
                 s
              )
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              not
              exp
               prefixexp
                a
             and
             exp
              exp
               prefixexp
                b
              ==
              exp
               prefixexp
                p
           )
       end
     stat
      functioncall
       check
       args
        (
        explist
         exp
          string
           "abc\xE3def"
         ,
         exp
          number
           4
        )
     stat
      functioncall
       check
       args
        (
        explist
         exp
          string
           "\xF4\x9F\xBF"
         ,
         exp
          number
           1
        )
     stat
      functioncall
       check
       args
        (
        explist
         exp
          string
           "\xF4\x9F\xBF\xBF"
         ,
         exp
          number
           1
        )
     stat
      functioncall
       check
       args
        (
        explist
         exp
          string
           "汉字\x80"
         ,
         exp
          exp
           #
           exp
            prefixexp
             (
             exp
              string
               "汉字"
             )
          +
          exp
           number
            1
        )
     stat
      functioncall
       check
       args
        (
        explist
         exp
          string
           "\x80hello"
         ,
         exp
          number
           1
        )
     stat
      functioncall
       check
       args
        (
        explist
         exp
          string
           "hel\x80lo"
         ,
         exp
          number
           4
        )
     stat
      functioncall
       check
       args
        (
        explist
         exp
          string
           "汉字\xBF"
         ,
         exp
          exp
           #
           exp
            prefixexp
             (
             exp
              string
               "汉字"
             )
          +
          exp
           number
            1
        )
     stat
      functioncall
       check
       args
        (
        explist
         exp
          string
           "\xBFhello"
         ,
         exp
          number
           1
        )
     stat
      functioncall
       check
       args
        (
        explist
         exp
          string
           "hel\xBFlo"
         ,
         exp
          number
           4
        )
    end
   stat
    do
    block
     stat
      local
      function
      errorcodes
      funcbody
       (
       parlist
        namelist
         s
       )
       block
        stat
         functioncall
          checkerror
          args
           (
           explist
            exp
             string
              "invalid UTF%-8 code"
            ,
            exp
             functiondef
              function
              funcbody
               (
               parlist
               )
               block
                stat
                 for
                 namelist
                  c
                 in
                 explist
                  exp
                   prefixexp
                    functioncall
                     utf8
                     .
                     codes
                     args
                      (
                      explist
                       exp
                        prefixexp
                         s
                      )
                 do
                 block
                  stat
                   functioncall
                    assert
                    args
                     (
                     explist
                      exp
                       prefixexp
                        c
                     )
                 end
               end
           )
       end
     stat
      functioncall
       errorcodes
       args
        (
        explist
         exp
          string
           "ab\xff"
        )
     stat
      functioncall
       errorcodes
       args
        (
        explist
         exp
          string
           "\u{110000}"
        )
     stat
      functioncall
       errorcodes
       args
        (
        explist
         exp
          string
           "in\x80valid"
        )
     stat
      functioncall
       errorcodes
       args
        (
        explist
         exp
          string
           "\xbfinvalid"
        )
     stat
      functioncall
       errorcodes
       args
        (
        explist
         exp
          string
           "αλφ\xBFα"
        )
     stat
      local
      attnamelist
       f
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          utf8
          .
          codes
          args
           (
           explist
            exp
             string
              ""
           )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             f
             args
              (
              explist
               exp
                string
                 ""
               ,
               exp
                number
                 2
              )
          ==
          exp
           nil
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             f
             args
              (
              explist
               exp
                string
                 ""
               ,
               exp
                -
                exp
                 number
                  1
              )
          ==
          exp
           nil
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             f
             args
              (
              explist
               exp
                string
                 ""
               ,
               exp
                prefixexp
                 math
                 .
                 mininteger
              )
          ==
          exp
           nil
        )
    end
   stat
    functioncall
     checkerror
     args
      (
      explist
       exp
        string
         "position out of bounds"
       ,
       exp
        prefixexp
         utf8
         .
         offset
       ,
       exp
        string
         "abc"
       ,
       exp
        number
         1
       ,
       exp
        number
         5
      )
   stat
    functioncall
     checkerror
     args
      (
      explist
       exp
        string
         "position out of bounds"
       ,
       exp
        prefixexp
         utf8
         .
         offset
       ,
       exp
        string
         "abc"
       ,
       exp
        number
         1
       ,
       exp
        -
        exp
         number
          4
      )
   stat
    functioncall
     checkerror
     args
      (
      explist
       exp
        string
         "position out of bounds"
       ,
       exp
        prefixexp
         utf8
         .
         offset
       ,
       exp
        string
         ""
       ,
       exp
        number
         1
       ,
       exp
        number
         2
      )
   stat
    functioncall
     checkerror
     args
      (
      explist
       exp
        string
         "position out of bounds"
       ,
       exp
        prefixexp
         utf8
         .
         offset
       ,
       exp
        string
         ""
       ,
       exp
        number
         1
       ,
       exp
        -
        exp
         number
          1
      )
   stat
    functioncall
     checkerror
     args
      (
      explist
       exp
        string
         "continuation byte"
       ,
       exp
        prefixexp
         utf8
         .
         offset
       ,
       exp
        string
         "𦧺"
       ,
       exp
        number
         1
       ,
       exp
        number
         2
      )
   stat
    functioncall
     checkerror
     args
      (
      explist
       exp
        string
         "continuation byte"
       ,
       exp
        prefixexp
         utf8
         .
         offset
       ,
       exp
        string
         "𦧺"
       ,
       exp
        number
         1
       ,
       exp
        number
         2
      )
   stat
    functioncall
     checkerror
     args
      (
      explist
       exp
        string
         "continuation byte"
       ,
       exp
        prefixexp
         utf8
         .
         offset
       ,
       exp
        string
         "\x80"
       ,
       exp
        number
         1
      )
   stat
    functioncall
     checkerror
     args
      (
      explist
       exp
        string
         "out of bounds"
       ,
       exp
        prefixexp
         utf8
         .
         len
       ,
       exp
        string
         "abc"
       ,
       exp
        number
         0
       ,
       exp
        number
         2
      )
   stat
    functioncall
     checkerror
     args
      (
      explist
       exp
        string
         "out of bounds"
       ,
       exp
        prefixexp
         utf8
         .
         len
       ,
       exp
        string
         "abc"
       ,
       exp
        number
         1
       ,
       exp
        number
         4
      )
   stat
    local
    attnamelist
     s
     attrib
    =
    explist
     exp
      string
       "hello World"
   stat
    local
    attnamelist
     t
     attrib
    =
    explist
     exp
      tableconstructor
       {
       fieldlist
        field
         exp
          prefixexp
           functioncall
            string
            .
            byte
            args
             (
             explist
              exp
               prefixexp
                s
              ,
              exp
               number
                1
              ,
              exp
               -
               exp
                number
                 1
             )
       }
   stat
    for
    i
    =
    exp
     number
      1
    ,
    exp
     prefixexp
      functioncall
       utf8
       .
       len
       args
        (
        explist
         exp
          prefixexp
           s
        )
    do
    block
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            t
            [
            exp
             prefixexp
              i
            ]
          ==
          exp
           prefixexp
            functioncall
             string
             .
             byte
             args
              (
              explist
               exp
                prefixexp
                 s
               ,
               exp
                prefixexp
                 i
              )
        )
    end
   stat
    functioncall
     check
     args
      (
      explist
       exp
        prefixexp
         s
       ,
       exp
        prefixexp
         t
      )
   stat
    functioncall
     check
     args
      (
      explist
       exp
        string
         "汉字/漢字"
       ,
       exp
        tableconstructor
         {
         fieldlist
          field
           exp
            number
             27721
          fieldsep
           ,
          field
           exp
            number
             23383
          fieldsep
           ,
          field
           exp
            number
             47
          fieldsep
           ,
          field
           exp
            number
             28450
          fieldsep
           ,
          field
           exp
            number
             23383
          fieldsep
           ,
         }
      )
   stat
    do
    block
     stat
      local
      attnamelist
       s
       attrib
      =
      explist
       exp
        string
         "áéí\128"
     stat
      local
      attnamelist
       t
       attrib
      =
      explist
       exp
        tableconstructor
         {
         fieldlist
          field
           exp
            prefixexp
             functioncall
              utf8
              .
              codepoint
              args
               (
               explist
                exp
                 prefixexp
                  s
                ,
                exp
                 number
                  1
                ,
                exp
                 exp
                  #
                  exp
                   prefixexp
                    s
                 -
                 exp
                  number
                   1
               )
         }
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           exp
            exp
             exp
              #
              exp
               prefixexp
                t
             ==
             exp
              number
               3
            and
            exp
             exp
              prefixexp
               t
               [
               exp
                number
                 1
               ]
             ==
             exp
              number
               225
           and
           exp
            exp
             prefixexp
              t
              [
              exp
               number
                2
              ]
            ==
            exp
             number
              233
          and
          exp
           exp
            prefixexp
             t
             [
             exp
              number
               3
             ]
           ==
           exp
            number
             237
        )
     stat
      functioncall
       checkerror
       args
        (
        explist
         exp
          string
           "invalid UTF%-8 code"
         ,
         exp
          prefixexp
           utf8
           .
           codepoint
         ,
         exp
          prefixexp
           s
         ,
         exp
          number
           1
         ,
         exp
          #
          exp
           prefixexp
            s
        )
     stat
      functioncall
       checkerror
       args
        (
        explist
         exp
          string
           "out of bounds"
         ,
         exp
          prefixexp
           utf8
           .
           codepoint
         ,
         exp
          prefixexp
           s
         ,
         exp
          exp
           #
           exp
            prefixexp
             s
          +
          exp
           number
            1
        )
     stat
      varlist
       var
        t
      =
      explist
       exp
        tableconstructor
         {
         fieldlist
          field
           exp
            prefixexp
             functioncall
              utf8
              .
              codepoint
              args
               (
               explist
                exp
                 prefixexp
                  s
                ,
                exp
                 number
                  4
                ,
                exp
                 number
                  3
               )
         }
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           #
           exp
            prefixexp
             t
          ==
          exp
           number
            0
        )
     stat
      functioncall
       checkerror
       args
        (
        explist
         exp
          string
           "out of bounds"
         ,
         exp
          prefixexp
           utf8
           .
           codepoint
         ,
         exp
          prefixexp
           s
         ,
         exp
          -
          exp
           prefixexp
            (
            exp
             exp
              #
              exp
               prefixexp
                s
             +
             exp
              number
               1
            )
         ,
         exp
          number
           1
        )
     stat
      functioncall
       checkerror
       args
        (
        explist
         exp
          string
           "out of bounds"
         ,
         exp
          prefixexp
           utf8
           .
           codepoint
         ,
         exp
          prefixexp
           s
         ,
         exp
          number
           1
         ,
         exp
          exp
           #
           exp
            prefixexp
             s
          +
          exp
           number
            1
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             utf8
             .
             codepoint
             args
              (
              explist
               exp
                string
                 "\u{D7FF}"
              )
          ==
          exp
           exp
            number
             0xD800
           -
           exp
            number
             1
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             utf8
             .
             codepoint
             args
              (
              explist
               exp
                string
                 "\u{E000}"
              )
          ==
          exp
           exp
            number
             0xDFFF
           +
           exp
            number
             1
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             utf8
             .
             codepoint
             args
              (
              explist
               exp
                string
                 "\u{D800}"
               ,
               exp
                number
                 1
               ,
               exp
                number
                 1
               ,
               exp
                true
              )
          ==
          exp
           number
            0xD800
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             utf8
             .
             codepoint
             args
              (
              explist
               exp
                string
                 "\u{DFFF}"
               ,
               exp
                number
                 1
               ,
               exp
                number
                 1
               ,
               exp
                true
              )
          ==
          exp
           number
            0xDFFF
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             utf8
             .
             codepoint
             args
              (
              explist
               exp
                string
                 "\u{7FFFFFFF}"
               ,
               exp
                number
                 1
               ,
               exp
                number
                 1
               ,
               exp
                true
              )
          ==
          exp
           number
            0x7FFFFFFF
        )
    end
   stat
    functioncall
     assert
     args
      (
      explist
       exp
        exp
         prefixexp
          functioncall
           utf8
           .
           char
           args
            (
            )
        ==
        exp
         string
          ""
      )
   stat
    functioncall
     assert
     args
      (
      explist
       exp
        exp
         prefixexp
          functioncall
           utf8
           .
           char
           args
            (
            explist
             exp
              number
               0
             ,
             exp
              number
               97
             ,
             exp
              number
               98
             ,
             exp
              number
               99
             ,
             exp
              number
               1
            )
        ==
        exp
         string
          "\0abc\1"
      )
   stat
    functioncall
     assert
     args
      (
      explist
       exp
        exp
         prefixexp
          functioncall
           utf8
           .
           codepoint
           args
            (
            explist
             exp
              prefixexp
               functioncall
                utf8
                .
                char
                args
                 (
                 explist
                  exp
                   number
                    0x10FFFF
                 )
            )
        ==
        exp
         number
          0x10FFFF
      )
   stat
    functioncall
     assert
     args
      (
      explist
       exp
        exp
         prefixexp
          functioncall
           utf8
           .
           codepoint
           args
            (
            explist
             exp
              prefixexp
               functioncall
                utf8
                .
                char
                args
                 (
                 explist
                  exp
                   number
                    0x7FFFFFFF
                 )
             ,
             exp
              number
               1
             ,
             exp
              number
               1
             ,
             exp
              true
            )
        ==
        exp
         exp
          prefixexp
           (
           exp
            exp
             number
              1
            <<
            exp
             number
              31
           )
         -
         exp
          number
           1
      )
   stat
    functioncall
     checkerror
     args
      (
      explist
       exp
        string
         "value out of range"
       ,
       exp
        prefixexp
         utf8
         .
         char
       ,
       exp
        exp
         number
          0x7FFFFFFF
        +
        exp
         number
          1
      )
   stat
    functioncall
     checkerror
     args
      (
      explist
       exp
        string
         "value out of range"
       ,
       exp
        prefixexp
         utf8
         .
         char
       ,
       exp
        -
        exp
         number
          1
      )
   stat
    local
    function
    invalid
    funcbody
     (
     parlist
      namelist
       s
     )
     block
      stat
       functioncall
        checkerror
        args
         (
         explist
          exp
           string
            "invalid UTF%-8 code"
          ,
          exp
           prefixexp
            utf8
            .
            codepoint
          ,
          exp
           prefixexp
            s
         )
      stat
       functioncall
        assert
        args
         (
         explist
          exp
           not
           exp
            prefixexp
             functioncall
              utf8
              .
              len
              args
               (
               explist
                exp
                 prefixexp
                  s
               )
         )
     end
   stat
    functioncall
     invalid
     args
      (
      explist
       exp
        string
         "\xF4\x9F\xBF\xBF"
      )
   stat
    functioncall
     invalid
     args
      (
      explist
       exp
        string
         "\u{D800}"
      )
   stat
    functioncall
     invalid
     args
      (
      explist
       exp
        string
         "\u{DFFF}"
      )
   stat
    functioncall
     invalid
     args
      (
      explist
       exp
        string
         "\xC0\x80"
      )
   stat
    functioncall
     invalid
     args
      (
      explist
       exp
        string
         "\xC1\xBF"
      )
   stat
    functioncall
     invalid
     args
      (
      explist
       exp
        string
         "\xE0\x9F\xBF"
      )
   stat
    functioncall
     invalid
     args
      (
      explist
       exp
        string
         "\xF0\x8F\xBF\xBF"
      )
   stat
    functioncall
     invalid
     args
      (
      explist
       exp
        string
         "\x80"
      )
   stat
    functioncall
     invalid
     args
      (
      explist
       exp
        string
         "\xBF"
      )
   stat
    functioncall
     invalid
     args
      (
      explist
       exp
        string
         "\xFE"
      )
   stat
    functioncall
     invalid
     args
      (
      explist
       exp
        string
         "\xFF"
      )
   stat
    functioncall
     check
     args
      (
      explist
       exp
        string
         ""
       ,
       exp
        tableconstructor
         {
         }
      )
   stat
    varlist
     var
      s
    =
    explist
     exp
      string
       "\0 \x7F\z\n     \xC2\x80 \xDF\xBF\z\n     \xE0\xA0\x80 \xEF\xBF\xBF\z\n     \xF0\x90\x80\x80  \xF4\x8F\xBF\xBF"
   stat
    varlist
     var
      s
    =
    explist
     exp
      prefixexp
       functioncall
        string
        .
        gsub
        args
         (
         explist
          exp
           prefixexp
            s
          ,
          exp
           string
            " "
          ,
          exp
           string
            ""
         )
   stat
    functioncall
     check
     args
      (
      explist
       exp
        prefixexp
         s
       ,
       exp
        tableconstructor
         {
         fieldlist
          field
           exp
            number
             0
          fieldsep
           ,
          field
           exp
            number
             0x7F
          fieldsep
           ,
          field
           exp
            number
             0x80
          fieldsep
           ,
          field
           exp
            number
             0x7FF
          fieldsep
           ,
          field
           exp
            number
             0x800
          fieldsep
           ,
          field
           exp
            number
             0xFFFF
          fieldsep
           ,
          field
           exp
            number
             0x10000
          fieldsep
           ,
          field
           exp
            number
             0x10FFFF
         }
      )
   stat
    do
    block
     stat
      local
      attnamelist
       s
       attrib
      =
      explist
       exp
        string
         "\u{4000000}\u{7FFFFFFF}"
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           #
           exp
            prefixexp
             s
          ==
          exp
           number
            12
        )
     stat
      functioncall
       check
       args
        (
        explist
         exp
          prefixexp
           s
         ,
         exp
          tableconstructor
           {
           fieldlist
            field
             exp
              number
               0x4000000
            fieldsep
             ,
            field
             exp
              number
               0x7FFFFFFF
           }
         ,
         exp
          true
        )
     stat
      varlist
       var
        s
      =
      explist
       exp
        string
         "\u{200000}\u{3FFFFFF}"
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           #
           exp
            prefixexp
             s
          ==
          exp
           number
            10
        )
     stat
      functioncall
       check
       args
        (
        explist
         exp
          prefixexp
           s
         ,
         exp
          tableconstructor
           {
           fieldlist
            field
             exp
              number
               0x200000
            fieldsep
             ,
            field
             exp
              number
               0x3FFFFFF
           }
         ,
         exp
          true
        )
     stat
      varlist
       var
        s
      =
      explist
       exp
        string
         "\u{10000}\u{1fffff}"
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           #
           exp
            prefixexp
             s
          ==
          exp
           number
            8
        )
     stat
      functioncall
       check
       args
        (
        explist
         exp
          prefixexp
           s
         ,
         exp
          tableconstructor
           {
           fieldlist
            field
             exp
              number
               0x10000
            fieldsep
             ,
            field
             exp
              number
               0x1FFFFF
           }
         ,
         exp
          true
        )
    end
   stat
    local
    attnamelist
     x
     attrib
    =
    explist
     exp
      string
       "日本語a-4\0éó"
   stat
    functioncall
     check
     args
      (
      explist
       exp
        prefixexp
         x
       ,
       exp
        tableconstructor
         {
         fieldlist
          field
           exp
            number
             26085
          fieldsep
           ,
          field
           exp
            number
             26412
          fieldsep
           ,
          field
           exp
            number
             35486
          fieldsep
           ,
          field
           exp
            number
             97
          fieldsep
           ,
          field
           exp
            number
             45
          fieldsep
           ,
          field
           exp
            number
             52
          fieldsep
           ,
          field
           exp
            number
             0
          fieldsep
           ,
          field
           exp
            number
             233
          fieldsep
           ,
          field
           exp
            number
             243
         }
      )
   stat
    functioncall
     check
     args
      (
      explist
       exp
        string
         "𣲷𠜎𠱓𡁻𠵼ab𠺢"
       ,
       exp
        tableconstructor
         {
         fieldlist
          field
           exp
            number
             0x23CB7
          fieldsep
           ,
          field
           exp
            number
             0x2070E
          fieldsep
           ,
          field
           exp
            number
             0x20C53
          fieldsep
           ,
          field
           exp
            number
             0x2107B
          fieldsep
           ,
          field
           exp
            number
             0x20D7C
          fieldsep
           ,
          field
           exp
            number
             0x61
          fieldsep
           ,
          field
           exp
            number
             0x62
          fieldsep
           ,
          field
           exp
            number
             0x20EA2
          fieldsep
           ,
         }
      )
   stat
    functioncall
     check
     args
      (
      explist
       exp
        string
         "𨳊𩶘𦧺𨳒𥄫𤓓\xF4\x8F\xBF\xBF"
       ,
       exp
        tableconstructor
         {
         fieldlist
          field
           exp
            number
             0x28CCA
          fieldsep
           ,
          field
           exp
            number
             0x29D98
          fieldsep
           ,
          field
           exp
            number
             0x269FA
          fieldsep
           ,
          field
           exp
            number
             0x28CD2
          fieldsep
           ,
          field
           exp
            number
             0x2512B
          fieldsep
           ,
          field
           exp
            number
             0x244D3
          fieldsep
           ,
          field
           exp
            number
             0x10ffff
         }
      )
   stat
    local
    attnamelist
     i
     attrib
    =
    explist
     exp
      number
       0
   stat
    for
    namelist
     p
     ,
     c
    in
    explist
     exp
      prefixexp
       functioncall
        string
        .
        gmatch
        args
         (
         explist
          exp
           prefixexp
            x
          ,
          exp
           exp
            string
             "()("
           ..
           exp
            exp
             prefixexp
              utf8
              .
              charpattern
            ..
            exp
             string
              ")"
         )
    do
    block
     stat
      varlist
       var
        i
      =
      explist
       exp
        exp
         prefixexp
          i
        +
        exp
         number
          1
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             utf8
             .
             offset
             args
              (
              explist
               exp
                prefixexp
                 x
               ,
               exp
                prefixexp
                 i
              )
          ==
          exp
           prefixexp
            p
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             utf8
             .
             len
             args
              (
              explist
               exp
                prefixexp
                 x
               ,
               exp
                prefixexp
                 p
              )
          ==
          exp
           exp
            exp
             prefixexp
              functioncall
               utf8
               .
               len
               args
                (
                explist
                 exp
                  prefixexp
                   x
                )
            -
            exp
             prefixexp
              i
           +
           exp
            number
             1
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            functioncall
             utf8
             .
             len
             args
              (
              explist
               exp
                prefixexp
                 c
              )
          ==
          exp
           number
            1
        )
     stat
      for
      j
      =
      exp
       number
        1
      ,
      exp
       exp
        #
        exp
         prefixexp
          c
       -
       exp
        number
         1
      do
      block
       stat
        functioncall
         assert
         args
          (
          explist
           exp
            exp
             prefixexp
              functioncall
               utf8
               .
               offset
               args
                (
                explist
                 exp
                  prefixexp
                   x
                 ,
                 exp
                  number
                   0
                 ,
                 exp
                  exp
                   exp
                    prefixexp
                     p
                   +
                   exp
                    prefixexp
                     j
                  -
                  exp
                   number
                    1
                )
            ==
            exp
             prefixexp
              p
          )
      end
    end
   stat
    functioncall
     print
     args
      string
       'ok'
 <EOF>
