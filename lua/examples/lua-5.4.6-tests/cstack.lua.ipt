start_
 chunk
  block
   stat
    local
    attnamelist
     tracegc
     attrib
    =
    explist
     exp
      prefixexp
       functioncall
        require
        args
         string
          "tracegc"
   stat
    functioncall
     print
     args
      string
       "testing stack overflow detection"
   stat
    local
    function
    checkerror
    funcbody
     (
     parlist
      namelist
       msg
       ,
       f
      ,
      ...
     )
     block
      stat
       local
       attnamelist
        s
        attrib
        ,
        err
        attrib
       =
       explist
        exp
         prefixexp
          functioncall
           pcall
           args
            (
            explist
             exp
              prefixexp
               f
             ,
             exp
              ...
            )
      stat
       functioncall
        assert
        args
         (
         explist
          exp
           exp
            not
            exp
             prefixexp
              s
           and
           exp
            prefixexp
             functioncall
              string
              .
              find
              args
               (
               explist
                exp
                 prefixexp
                  err
                ,
                exp
                 prefixexp
                  msg
               )
         )
     end
   stat
    do
    block
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "testing stack overflow in message handling"
        )
     stat
      local
      attnamelist
       count
       attrib
      =
      explist
       exp
        number
         0
     stat
      local
      function
      loop
      funcbody
       (
       parlist
        namelist
         x
         ,
         y
         ,
         z
       )
       block
        stat
         varlist
          var
           count
         =
         explist
          exp
           exp
            prefixexp
             count
           +
           exp
            number
             1
        retstat
         return
         explist
          exp
           exp
            number
             1
           +
           exp
            prefixexp
             functioncall
              loop
              args
               (
               explist
                exp
                 prefixexp
                  x
                ,
                exp
                 prefixexp
                  y
                ,
                exp
                 prefixexp
                  z
               )
       end
     stat
      functioncall
       tracegc
       .
       stop
       args
        (
        )
     stat
      local
      attnamelist
       res
       attrib
       ,
       msg
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          xpcall
          args
           (
           explist
            exp
             prefixexp
              loop
            ,
            exp
             prefixexp
              loop
           )
     stat
      functioncall
       tracegc
       .
       start
       args
        (
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           prefixexp
            msg
          ==
          exp
           string
            "error in error handling"
        )
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "final count: "
         ,
         exp
          prefixexp
           count
        )
    end
   stat
    do
    block
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "testing recursion inside pattern matching"
        )
     stat
      local
      function
      f
      funcbody
       (
       parlist
        namelist
         size
       )
       block
        stat
         local
         attnamelist
          s
          attrib
         =
         explist
          exp
           prefixexp
            functioncall
             string
             .
             rep
             args
              (
              explist
               exp
                string
                 "a"
               ,
               exp
                prefixexp
                 size
              )
        stat
         local
         attnamelist
          p
          attrib
         =
         explist
          exp
           prefixexp
            functioncall
             string
             .
             rep
             args
              (
              explist
               exp
                string
                 ".?"
               ,
               exp
                prefixexp
                 size
              )
        retstat
         return
         explist
          exp
           prefixexp
            functioncall
             string
             .
             match
             args
              (
              explist
               exp
                prefixexp
                 s
               ,
               exp
                prefixexp
                 p
              )
       end
     stat
      local
      attnamelist
       m
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          f
          args
           (
           explist
            exp
             number
              80
           )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           #
           exp
            prefixexp
             m
          ==
          exp
           number
            80
        )
     stat
      functioncall
       checkerror
       args
        (
        explist
         exp
          string
           "too complex"
         ,
         exp
          prefixexp
           f
         ,
         exp
          number
           2000
        )
    end
   stat
    do
    block
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "testing stack-overflow in recursive 'gsub'"
        )
     stat
      local
      attnamelist
       count
       attrib
      =
      explist
       exp
        number
         0
     stat
      local
      function
      foo
      funcbody
       (
       parlist
       )
       block
        stat
         varlist
          var
           count
         =
         explist
          exp
           exp
            prefixexp
             count
           +
           exp
            number
             1
        stat
         functioncall
          string
          .
          gsub
          args
           (
           explist
            exp
             string
              "a"
            ,
            exp
             string
              "."
            ,
            exp
             prefixexp
              foo
           )
       end
     stat
      functioncall
       checkerror
       args
        (
        explist
         exp
          string
           "stack overflow"
         ,
         exp
          prefixexp
           foo
        )
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "final count: "
         ,
         exp
          prefixexp
           count
        )
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "testing stack-overflow in recursive 'gsub' with metatables"
        )
     stat
      local
      attnamelist
       count
       attrib
      =
      explist
       exp
        number
         0
     stat
      local
      attnamelist
       t
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          setmetatable
          args
           (
           explist
            exp
             tableconstructor
              {
              }
            ,
            exp
             tableconstructor
              {
              fieldlist
               field
                __index
                =
                exp
                 prefixexp
                  foo
              }
           )
     stat
      varlist
       var
        foo
      =
      explist
       exp
        functiondef
         function
         funcbody
          (
          parlist
          )
          block
           stat
            varlist
             var
              count
            =
            explist
             exp
              exp
               prefixexp
                count
              +
              exp
               number
                1
           stat
            functioncall
             string
             .
             gsub
             args
              (
              explist
               exp
                string
                 "a"
               ,
               exp
                string
                 "."
               ,
               exp
                prefixexp
                 t
              )
          end
     stat
      functioncall
       checkerror
       args
        (
        explist
         exp
          string
           "stack overflow"
         ,
         exp
          prefixexp
           foo
        )
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "final count: "
         ,
         exp
          prefixexp
           count
        )
    end
   stat
    do
    block
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "testing limits in coroutines inside deep calls"
        )
     stat
      local
      attnamelist
       count
       attrib
      =
      explist
       exp
        number
         0
     stat
      local
      attnamelist
       lim
       attrib
      =
      explist
       exp
        number
         1000
     stat
      local
      function
      stack
      funcbody
       (
       parlist
        namelist
         n
       )
       block
        stat
         if
         exp
          exp
           prefixexp
            n
          >
          exp
           number
            0
         then
         block
          retstat
           return
           explist
            exp
             exp
              prefixexp
               functioncall
                stack
                args
                 (
                 explist
                  exp
                   exp
                    prefixexp
                     n
                   -
                   exp
                    number
                     1
                 )
             +
             exp
              number
               1
         else
         block
          stat
           functioncall
            functioncall
             coroutine
             .
             wrap
             args
              (
              explist
               exp
                functiondef
                 function
                 funcbody
                  (
                  parlist
                  )
                  block
                   stat
                    varlist
                     var
                      count
                    =
                    explist
                     exp
                      exp
                       prefixexp
                        count
                      +
                      exp
                       number
                        1
                   stat
                    functioncall
                     stack
                     args
                      (
                      explist
                       exp
                        prefixexp
                         lim
                      )
                  end
              )
            args
             (
             )
         end
       end
     stat
      local
      attnamelist
       st
       attrib
       ,
       msg
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          xpcall
          args
           (
           explist
            exp
             prefixexp
              stack
            ,
            exp
             functiondef
              function
              funcbody
               (
               parlist
               )
               block
                retstat
                 return
                 explist
                  exp
                   string
                    "ok"
               end
            ,
            exp
             prefixexp
              lim
           )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           not
           exp
            prefixexp
             st
          and
          exp
           exp
            prefixexp
             msg
           ==
           exp
            string
             "ok"
        )
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "final count: "
         ,
         exp
          prefixexp
           count
        )
    end
   stat
    do
    block
     stat
      local
      attnamelist
       count
       attrib
      =
      explist
       exp
        number
         0
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "chain of 'coroutine.close'"
        )
     stat
      local
      attnamelist
       coro
       attrib
      =
      explist
       exp
        false
     stat
      for
      i
      =
      exp
       number
        1
      ,
      exp
       number
        1000
      do
      block
       stat
        local
        attnamelist
         previous
         attrib
        =
        explist
         exp
          prefixexp
           coro
       stat
        varlist
         var
          coro
        =
        explist
         exp
          prefixexp
           functioncall
            coroutine
            .
            create
            args
             (
             explist
              exp
               functiondef
                function
                funcbody
                 (
                 parlist
                 )
                 block
                  stat
                   local
                   attnamelist
                    cc
                    attrib
                     <
                     close
                     >
                   =
                   explist
                    exp
                     prefixexp
                      functioncall
                       setmetatable
                       args
                        (
                        explist
                         exp
                          tableconstructor
                           {
                           }
                         ,
                         exp
                          tableconstructor
                           {
                           fieldlist
                            field
                             __close
                             =
                             exp
                              functiondef
                               function
                               funcbody
                                (
                                parlist
                                )
                                block
                                 stat
                                  varlist
                                   var
                                    count
                                  =
                                  explist
                                   exp
                                    exp
                                     prefixexp
                                      count
                                    +
                                    exp
                                     number
                                      1
                                 stat
                                  if
                                  exp
                                   prefixexp
                                    previous
                                  then
                                  block
                                   stat
                                    functioncall
                                     assert
                                     args
                                      (
                                      explist
                                       exp
                                        prefixexp
                                         functioncall
                                          coroutine
                                          .
                                          close
                                          args
                                           (
                                           explist
                                            exp
                                             prefixexp
                                              previous
                                           )
                                      )
                                  end
                                end
                           }
                        )
                  stat
                   functioncall
                    coroutine
                    .
                    yield
                    args
                     (
                     )
                 end
             )
       stat
        functioncall
         assert
         args
          (
          explist
           exp
            prefixexp
             functioncall
              coroutine
              .
              resume
              args
               (
               explist
                exp
                 prefixexp
                  coro
               )
          )
      end
     stat
      local
      attnamelist
       st
       attrib
       ,
       msg
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          coroutine
          .
          close
          args
           (
           explist
            exp
             prefixexp
              coro
           )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           not
           exp
            prefixexp
             st
          and
          exp
           prefixexp
            functioncall
             string
             .
             find
             args
              (
              explist
               exp
                prefixexp
                 msg
               ,
               exp
                string
                 "C stack overflow"
              )
        )
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "final count: "
         ,
         exp
          prefixexp
           count
        )
    end
   stat
    do
    block
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "nesting of resuming yielded coroutines"
        )
     stat
      local
      attnamelist
       count
       attrib
      =
      explist
       exp
        number
         0
     stat
      local
      function
      body
      funcbody
       (
       parlist
       )
       block
        stat
         functioncall
          coroutine
          .
          yield
          args
           (
           )
        stat
         local
         attnamelist
          f
          attrib
         =
         explist
          exp
           prefixexp
            functioncall
             coroutine
             .
             wrap
             args
              (
              explist
               exp
                prefixexp
                 body
              )
        stat
         functioncall
          f
          args
           (
           )
        stat
         ;
        stat
         varlist
          var
           count
         =
         explist
          exp
           exp
            prefixexp
             count
           +
           exp
            number
             1
        stat
         functioncall
          f
          args
           (
           )
       end
     stat
      local
      attnamelist
       f
       attrib
      =
      explist
       exp
        prefixexp
         functioncall
          coroutine
          .
          wrap
          args
           (
           explist
            exp
             prefixexp
              body
           )
     stat
      functioncall
       f
       args
        (
        )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          not
          exp
           prefixexp
            functioncall
             pcall
             args
              (
              explist
               exp
                prefixexp
                 f
              )
        )
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "final count: "
         ,
         exp
          prefixexp
           count
        )
    end
   stat
    do
    block
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "nesting coroutines running after recoverable errors"
        )
     stat
      local
      attnamelist
       count
       attrib
      =
      explist
       exp
        number
         0
     stat
      local
      function
      foo
      funcbody
       (
       parlist
       )
       block
        stat
         varlist
          var
           count
         =
         explist
          exp
           exp
            prefixexp
             count
           +
           exp
            number
             1
        stat
         functioncall
          pcall
          args
           (
           explist
            exp
             number
              1
           )
        stat
         functioncall
          functioncall
           coroutine
           .
           wrap
           args
            (
            explist
             exp
              prefixexp
               foo
            )
          args
           (
           )
       end
     stat
      functioncall
       checkerror
       args
        (
        explist
         exp
          string
           "C stack overflow"
         ,
         exp
          prefixexp
           foo
        )
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "final count: "
         ,
         exp
          prefixexp
           count
        )
    end
   stat
    if
    exp
     prefixexp
      T
    then
    block
     stat
      functioncall
       print
       args
        (
        explist
         exp
          string
           "testing stack recovery"
        )
     stat
      local
      attnamelist
       N
       attrib
      =
      explist
       exp
        number
         0
     stat
      local
      attnamelist
       LIM
       attrib
      =
      explist
       exp
        -
        exp
         number
          1
     stat
      local
      attnamelist
       stack1
       attrib
     stat
      local
      attnamelist
       dummy
       attrib
     stat
      local
      function
      err
      funcbody
       (
       parlist
        namelist
         msg
       )
       block
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             prefixexp
              functioncall
               string
               .
               find
               args
                (
                explist
                 exp
                  prefixexp
                   msg
                 ,
                 exp
                  string
                   "stack overflow"
                )
           )
        stat
         local
         attnamelist
          _
          attrib
          ,
          stacknow
          attrib
         =
         explist
          exp
           prefixexp
            functioncall
             T
             .
             stacklevel
             args
              (
              )
        stat
         functioncall
          assert
          args
           (
           explist
            exp
             exp
              prefixexp
               stacknow
             ==
             exp
              exp
               prefixexp
                stack1
              +
              exp
               number
                200
           )
       end
     stat
      local
      function
      f
      funcbody
       (
       parlist
       )
       block
        stat
         varlist
          var
           dummy
          ,
          var
           stack1
         =
         explist
          exp
           prefixexp
            functioncall
             T
             .
             stacklevel
             args
              (
              )
        stat
         if
         exp
          exp
           prefixexp
            N
          ==
          exp
           prefixexp
            LIM
         then
         block
          stat
           functioncall
            xpcall
            args
             (
             explist
              exp
               prefixexp
                f
              ,
              exp
               prefixexp
                err
             )
          stat
           local
           attnamelist
            _
            attrib
            ,
            stacknow
            attrib
           =
           explist
            exp
             prefixexp
              functioncall
               T
               .
               stacklevel
               args
                (
                )
          stat
           functioncall
            assert
            args
             (
             explist
              exp
               exp
                prefixexp
                 stacknow
               ==
               exp
                prefixexp
                 stack1
             )
          retstat
           return
         end
        stat
         varlist
          var
           N
         =
         explist
          exp
           exp
            prefixexp
             N
           +
           exp
            number
             1
        stat
         functioncall
          f
          args
           (
           )
       end
     stat
      local
      attnamelist
       topB
       attrib
       ,
       sizeB
       attrib
     stat
      local
      attnamelist
       topA
       attrib
       ,
       sizeA
       attrib
     stat
      varlist
       var
        topB
       ,
       var
        sizeB
      =
      explist
       exp
        prefixexp
         functioncall
          T
          .
          stacklevel
          args
           (
           )
     stat
      functioncall
       tracegc
       .
       stop
       args
        (
        )
     stat
      functioncall
       xpcall
       args
        (
        explist
         exp
          prefixexp
           f
         ,
         exp
          prefixexp
           err
        )
     stat
      functioncall
       tracegc
       .
       start
       args
        (
        )
     stat
      varlist
       var
        topA
       ,
       var
        sizeA
      =
      explist
       exp
        prefixexp
         functioncall
          T
          .
          stacklevel
          args
           (
           )
     stat
      functioncall
       assert
       args
        (
        explist
         exp
          exp
           exp
            prefixexp
             topA
           ==
           exp
            prefixexp
             topB
          and
          exp
           exp
            prefixexp
             sizeA
           <
           exp
            exp
             prefixexp
              sizeB
            *
            exp
             number
              2
        )
     stat
      functioncall
       print
       args
        (
        explist
         exp
          prefixexp
           functioncall
            string
            .
            format
            args
             (
             explist
              exp
               string
                "maximum stack size: %d"
              ,
              exp
               prefixexp
                stack1
             )
        )
     stat
      varlist
       var
        LIM
      =
      explist
       exp
        prefixexp
         N
     stat
      varlist
       var
        N
      =
      explist
       exp
        number
         0
     stat
      functioncall
       tracegc
       .
       stop
       args
        (
        )
     stat
      functioncall
       f
       args
        (
        )
     stat
      functioncall
       tracegc
       .
       start
       args
        (
        )
     stat
      functioncall
       print
       args
        string
         "+"
    end
   stat
    functioncall
     print
     args
      string
       'OK'
 <EOF>
